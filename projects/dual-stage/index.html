<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Dual-Stage 3D Printing | Noah West </title> <meta name="author" content="Noah West"> <meta name="description" content="A research project applying dual stage control to 3D printing."> <meta name="keywords" content="robotics, engineering, robotics-engineering, automation, jekyll, portfolio-website"> <meta property="og:site_name" content="Noah West"> <meta property="og:type" content="website"> <meta property="og:title" content="Noah West | Dual-Stage 3D Printing"> <meta property="og:url" content="https://nWestie.github.io/projects/dual-stage/"> <meta property="og:description" content="A research project applying dual stage control to 3D printing."> <meta property="og:image" content="/assets/img/prof_pic.jpg"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Dual-Stage 3D Printing"> <meta name="twitter:description" content="A research project applying dual stage control to 3D printing."> <meta name="twitter:image" content="/assets/img/prof_pic.jpg"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.webp?78677d414fd6f0722827c127adde95f7"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://nwestie.github.io/projects/dual-stage/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Noah West </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Github </a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">Resume </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Dual-Stage 3D Printing</h1> <p class="post-description">A research project applying dual stage control to 3D printing.</p> </header> <article> <hr> <h2 id="an-overview">An Overview:</h2> <p>As a part of Widener University’s summer research program, I joined a project under Dr. William Nagel working to apply dual-stage actuators to 3D printing in an effort to increase print speeds. Printing faster is a core goal of the 3D printing field, allowing each printer to be more productive, but machines quickly run into bandwidth limitations as speed increases. As high speed, an actuator’s precision becomes worse, and the precision of larger actuators will be worse than small ones. For 3D printing, this means that it is difficult to increase speed without switching to lower-range actuators, which would sacrifice working area.</p> <p>Dual stage systems address this by pairing a large, long rang actuator (LRA) with a smaller one capable of high speed and precision - allowing them to have both range and precision. For the purposes of our 3D printer, the nozzle is mounted to a short-range actuator(SRA) and the bed to the long range actuator(LRA), as illustrated below. However, because each axis now has 2 actuators, controlling it is more complex than a traditional printer. For my research, I focused on designing such a controller.</p> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/dsa-hardware-whitebg-200.webp 200w,/assets/img/dual-stage/dsa-hardware-whitebg-480.webp 480w,/assets/img/dual-stage/dsa-hardware-whitebg-800.webp 800w,/assets/img/dual-stage/dsa-hardware-whitebg-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/dsa-hardware-whitebg.png" width="100%" height="auto" title="Diagram of Dual stage printer actuators" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>In the final version of the control system(Non-causal controller), the path for each printer axis is generated by parsing standard 3D printing g-code, and then these target trajectories are split into targets for the LRA and SRA, using a low pass filter to separate the lower acceleration motions from the higher-acceleration parts. In previous versions(Reactive controller), the feedback controller received only a single target path for each axis, which it then used to generate commands for the two actuators, but filtering beforehand and separating the control loops improved performance (See <strong>implementation details</strong>). Below, you can see the final controller compared to this previous, single-loop reactive controller, as well as a reference of how the system would perform without the addition of the short range actuator.</p> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/overlaid-cutout-200.webp 200w,/assets/img/dual-stage/overlaid-cutout-480.webp 480w,/assets/img/dual-stage/overlaid-cutout-800.webp 800w,/assets/img/dual-stage/overlaid-cutout-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/overlaid-cutout.png" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Comparison of 3 actuators over 30x60mm rectangle</figcaption> </figure> </div> </div> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/error-comparison-200.webp 200w,/assets/img/dual-stage/error-comparison-480.webp 480w,/assets/img/dual-stage/error-comparison-800.webp 800w,/assets/img/dual-stage/error-comparison-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/error-comparison.png" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Error as speed increases.</figcaption> </figure> </div> </div> <p>If if instead error is held constant, we can compare the time needed to finish a sample print. Comparing times for each controller where the 98th percentile error is below 1mm resulted in the following print times:</p> <table> <thead> <tr> <th style="text-align: right">Printer</th> <th style="text-align: left">Print Time</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">X1 Carbon</td> <td style="text-align: left">15:29</td> </tr> <tr> <td style="text-align: right">LRA-only</td> <td style="text-align: left">37:40</td> </tr> <tr> <td style="text-align: right">Reactive</td> <td style="text-align: left">14:41</td> </tr> <tr> <td style="text-align: right">Non-Causal</td> <td style="text-align: left">4:55</td> </tr> </tbody> </table> <p><br> The commercially available Bamboo Labs X1 Carbon is included as a reference, with the time based off testing by <a href="https://www.tomshardware.com/news/3d-printer-speed-hierarchy" rel="external nofollow noopener" target="_blank">Tom’s hardware</a>. A simulation of the test ‘benchy’ print used is also shown below. These simulations show that applying dual-stage control to 3D printing shows promise, and I continue to work on this controller and the printer hardware with the project team. Overall, I learned a huge amount simulation and control, as well as gaining experience in the methodologies used for designing dual-stage systems.</p> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/benchy-600mms-200.webp 200w,/assets/img/dual-stage/benchy-600mms-480.webp 480w,/assets/img/dual-stage/benchy-600mms-800.webp 800w,/assets/img/dual-stage/benchy-600mms-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/benchy-600mms.png" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Simulated benchy print</figcaption> </figure> </div> </div> <h2 id="implementation-details">Implementation Details!</h2> <p>The part everyone’s been waiting for: how does this work in practice, and why is this system designed the way it is? At a high level, a 3D model is sliced (using <a href="https://www.prusa3d.com/prusaslicer/" rel="external nofollow noopener" target="_blank">PrusaSlicer</a>), and the g-code this generates is parsed into uniform-time trajectories listing the position of each actuator every millisecond. The X and Y trajectories are then low-pass filtered using a python script to generate LRA and SRA targets for these axes. These target trajectories are used as input to a Simulink model of the dual stage hardware, which is implemented using transfer functions of the dual stage hardware.</p> <p>The final controller has two key advantages over earlier versions: it uses a non-causal filter on the target trajectories, and separates the control loops for the long and short range actuators. This can be seen generally in the diagram below - showing the control structure for a single dual stage axis. The definitions for each system block are described under <strong>System Models</strong>.</p> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/system-diagram-whitebg-200.webp 200w,/assets/img/dual-stage/system-diagram-whitebg-480.webp 480w,/assets/img/dual-stage/system-diagram-whitebg-800.webp 800w,/assets/img/dual-stage/system-diagram-whitebg-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/system-diagram-whitebg.png" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>A standard low-pass filter removes the higher frequency components of a signal, which can be thought of as ‘smoothing’ it, but introduces some delay. This is the approach used by the reactive controller - where filtering takes place in the control loop. However, since the entire target path of the actuator is known, a <strong>non-causal</strong> filter can be used, meaning the filter accounts future target positions to calculate the current smoothed target, and removes the delaying effect. In practice, I used an iterative first order low pass filter of the form \(y[n]=(1-\alpha)*y[n-1]+\alpha*x[n]\), where \(y[n]\) is the output at time \(n\) and \(x[n]\) is the input.</p> <p>Running this first over filter over the target path forwards and then in reverse results in a second order filtered signal without the time delay introduced by causal filtering. When run over a time-reversed signal, the output depends on input values later in the trajectory, which is only possible because the input is known for all time. Removing the signal lag reduces the LRA error, allowing the system to be more accurate in its movement. In this controller, the SRA is assigned the difference between the original target and the low-pass filtered LRA target.</p> <div class="row mt-3 justify-content-sm-center"> <div class="col-md-8 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dual-stage/causal-noncausal-200.webp 200w,/assets/img/dual-stage/causal-noncausal-480.webp 480w,/assets/img/dual-stage/causal-noncausal-800.webp 800w,/assets/img/dual-stage/causal-noncausal-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/dual-stage/causal-noncausal.png" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Switching to two parallel feedback controllers also contributes to improved system performance, also making it much less sensitive to changes in PID tunings, speeding development. In the reactive controller, slight changes in the tuning parameters could cause significant oscillations in the output, but with separate feedback loops each PID controller can be tuned for their specific actuator, improving performance. It made sense to implement these two changes simultaneously, since the non-causal filtering requires having separate inputs to the LRA and SRA controllers and therefore separate control loops, however this makes it difficult to determine how much of the performance improvements can be attributed to each of these changes.</p> <h3 id="system-models">System Models:</h3> <p>For those interested, these are the transfer functions modeling the behavior of our printer as well as the PID controller and filters used in the simulation. \(LRA(s)\) and \(SRA(s)\) model the response of each actuator to an input, and \(PID_j\) represents a standard PID controller in the form of a transfer function. \(C_L\) is a first order low-pass filter, used to filter the PID output in the reactive controller.</p> \[𝑃𝐼𝐷_𝑗(𝑠)=𝑘_{𝑝_𝑗}+\frac{𝑘_{𝑖_𝑗}}{𝑠}+𝑘_{𝑑_𝑗}𝑠\] \[𝐶_𝐿(𝑠)=\frac{\omega_𝑐}{𝑠+\omega_𝑐}\] \[𝐿𝑅𝐴(𝑠)=𝑘_𝐿\frac{\omega_𝐿^2}{𝑠^2+2\zeta_𝐿 \omega_𝐿 𝑠+\omega_𝐿^2}\] \[𝑆𝑅𝐴(𝑠)=𝑘_𝑠\frac{𝜔_𝑠^2}{𝑠^2+2\zeta_𝑠 \omega_𝑠 𝑠+\omega_𝑠^2}*\frac{𝑠+𝑧}{𝑠+𝑝}\] <p><strong>Where:</strong></p> \[\omega_c=18Hz\] <table> <thead> <tr> <th style="text-align: right">Variable:</th> <th>\(PID_C\)</th> <th>\(PID_R\)</th> <th>\(PID_L\)</th> <th>\(PID_S\)</th> </tr> </thead> <tbody> <tr> <td style="text-align: right">\(k_p\)</td> <td>320</td> <td>4.2</td> <td>320</td> <td>175</td> </tr> <tr> <td style="text-align: right">\(k_i\)</td> <td>400</td> <td>770</td> <td>400</td> <td>700</td> </tr> <tr> <td style="text-align: right">\(k_d\)</td> <td>0.2</td> <td>0.28</td> <td>0.2</td> <td>0.455</td> </tr> </tbody> </table> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Noah West. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"About",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-projects",title:"Projects",description:"",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-github",title:"Github",description:"",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"nav-resume",title:"Resume",description:"A Resume for job searching",section:"Navigation",handler:()=>{window.location.href="/resume/"}},{id:"projects-cycloid-clock",title:"Cycloid Clock",description:"A customized designed clock based on a cycloidal drive.",section:"Projects",handler:()=>{window.location.href="/projects/cycloids/"}},{id:"projects-nxt-drawbot",title:"NXT Drawbot",description:"A custom pen plotter built with LEGO Mindstorms NXT.",section:"Projects",handler:()=>{window.location.href="/projects/drawbot/"}},{id:"projects-dual-stage-3d-printing",title:"Dual-Stage 3D Printing",description:"A research project applying dual stage control to 3D printing.",section:"Projects",handler:()=>{window.location.href="/projects/dual-stage/"}},{id:"projects-cad-hand",title:"CAD - Hand",description:"A human-like 3D printable hand actuated by strings.",section:"Projects",handler:()=>{window.location.href="/projects/hand-cad/"}},{id:"projects-rumors-set",title:"Rumors Set",description:"Designed and built a set for Neil Simon&#39;s Rumors",section:"Projects",handler:()=>{window.location.href="/projects/rumors/"}},{id:"projects-balance-bot",title:"Balance Bot",description:"A custom-designed balancing robot using teensy and C++",section:"Projects",handler:()=>{window.location.href="/projects/travis/"}},{id:"projects-tsa-hs",title:"TSA - HS",description:"Competed in the PA TSA CAD and flight events.",section:"Projects",handler:()=>{window.location.href="/projects/tsa/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%77%65%73%74%6E%6F%61%68%62@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/nWestie","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/nWestie","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>